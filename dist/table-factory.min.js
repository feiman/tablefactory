angular.module("ngTableFactory",[]).factory("TableFactory",["TableFactoryUtility","TableFactoryHtml","TableFactoryEvents",function(n,t,i){function r(r,u){function rt(){s=i.create();k=null;p=null;f=null;h=new wt;e={selected:[],checked:[]}}function wt(){this.indexes={};this.values={};this.toRef=function(n){return this.indexes[n]};this.toIndex=function(n){return this.values[n]}}function bt(t,i){if($(t).length<1){console.error("DatagridFactory > initialize > Container must be valid html element");return}if(f=n.defaults(i,{referenceField:null,columns:[],noWarn:!1,createdFn:null,data:n.defaults(i.data,{paged:!1,size:20,readerFn:null,readOnCreation:!0,total:null,rows:[],sort:n.defaults(i.data.sort,{field:null,index:null,direction:null})}),selection:n.defaults(i.selection,{canSelect:!0,canSelectMulti:!1,canCheck:!1,canCheckMulti:!1,selectionsLinked:!1,clearOnPaging:!1,clearOnSorting:!1}),layout:n.defaults(i.layout,{width:"100%",height:null,showHeader:!0,showFooter:!0,showClearCommand:!0,showRefreshCommand:!0,showTotals:!0,showSelections:!0,showCheckAll:!0}),css:n.defaults(i.css,{header:"table table-bordered",body:"table table-bordered table-striped",bodySelectable:"table-hover",footer:"table table-bordered",selection:"info"}),icons:n.defaults(i.icons,{checkTrue:"glyphicon glyphicon-check text-info",checkFalse:"glyphicon glyphicon-unchecked text-muted",pagerFirst:"glyphicon glyphicon-fast-backward",pagerPrev:"glyphicon glyphicon-step-backward",pagerNext:"glyphicon glyphicon-step-forward",pagerLast:"glyphicon glyphicon-fast-forward",refresh:"glyphicon glyphicon-refresh",erase:"glyphicon glyphicon-erase",orderAsc:"glyphicon glyphicon-sort-by-attributes",orderDesc:"glyphicon glyphicon-sort-by-attributes-alt",orderNone:"glyphicon glyphicon-sort",cmdConfirm:"glyphicon glyphicon-ok",cmdCancel:"glyphicon glyphicon-remove"}),labels:n.defaults(i.labels,{pageOfPages:"{0} of {1}",totalRecords:"{0} total records",totalRecordsPaged:"View {0} - {1} of {2} total records",noRecords:"no records",tooltipErase:"Clear selection",tooltipRefresh:"Clear sort and reload data",goToPage:"Type the desired page number"})}),f.noWarn=f.noWarn===!0,f.selection.canSelect=f.selection.canSelect===!0,f.selection.canSelectMulti=f.selection.canSelectMulti===!0,f.selection.canCheck=f.selection.canCheck===!0,f.selection.canCheckMulti=f.selection.canCheckMulti===!0,f.selection.selectionsLinked=f.selection.selectionsLinked===!0,f.selection.clearOnPaging=f.selection.clearOnPaging!==!1,f.selection.clearOnSorting=f.selection.clearOnSorting!==!1,f.layout.showHeader=f.layout.showHeader===!0,f.layout.showFooter=f.layout.showFooter===!0,f.layout.height=n.isValidCssSize(f.layout.height)?f.layout.height:null,f.layout.width=n.isValidCssSize(f.layout.width)?f.layout.width:null,f.layout.showClearCommand=f.layout.showClearCommand===!0,f.layout.showRefreshCommand=f.layout.showRefreshCommand===!0,f.layout.showSelections=f.layout.showSelections===!0,f.layout.showTotals=f.layout.showTotals===!0,f.data.paged=f.data.paged===!0,f.data.size=n.castAsNumeric(f.data.size),f.data.sort.field=n.isNotNoUoE(f.data.sort.field)?f.data.sort.field:null,f.data.sort.index=n.castAsNumeric(f.data.sort.index),f.data.sort.direction=n.contains(["asc","desc"],f.data.sort.direction)?f.data.sort.direction:null,f.noWarn&&n.isNoUoE(f.referenceField)&&(f.selection.canSelect||f.selection.canCheck)&&(console.warn("DatagridFactory > Create > 'Without specified (options).referenceField' all selections will be disabled"),f.selection={canSelect:!1,canCheck:!1}),n.isArrayNullOrEmpty(f.columns)){console.error("DatagridFactory > Create > '(options).columns' must contain a valid array of columns");return}f.columns=n.map(f.columns,function(t){return n.defaults(t,{caption:null,field:null,halign:"left",align:"left",multiline:!1,noCellContainer:!1,formatter:null})});n.each(f.columns,function(t){n.isNoUoE(t.caption)&&(t.caption=n.titleFromCamelCase(t.field));n.contains(["left","center","right"],t.halign)===!1&&(t.halign="left");n.contains(["left","center","right"],t.align)===!1&&(t.align="left");t.multiline=t.multiline!==!0;t.multiline=t.multiline!==!0;n.isNotNoU(t.formatter)&&n.isFunction(t.formatter)===!1&&(t.formatter=function(){return""},console.error("DatagridFactory > Create > Column > Column formatter must be a valid function."))});f.noWarn&&(f.selection.canSelect&&f.selection.canCheck)===!1&&f.selection.selectionsLinked&&console.warn("DatagridFactory > Create > '(options).selection.linked' has no sense if '(options).selection.canSelect' and '(options).selection.canCheck' aren't both true");f.noWarn&&!f.layout.showFooter&&f.data.paged&&console.warn("DatagridFactory > Create > '(options).data.paged' has no sense if '(options).layout.showFooter' is false");p=t;dt();ii();et();w();gt();s.raiseEvent(c.created);f.data.readOnCreation===!0&&v();n.isFunction(f.created)&&f.created.call(this,k)}function v(){if(n.isFunction(f.data.readerFn)===!1){console.error("DatagridFactory > ReadAsyncData > '(options).data.readerFn' function must be set before request data");return}f.data.page=n.isNoUoZ(f.data.page)?1:f.data.page;f.data.size=n.isNoUoZ(f.data.size)?20:f.data.size;var t=f.data.paged?f.data.page:null,i=f.data.paged?f.data.size:null,r={page:t,size:i,sortField:f.data.sort.field,sortDir:f.data.sort.direction},u=function(t,i){if(n.isArray(t)===!1||n.castAsNumeric(i)===null){console.error("DatagridFactory > ReadAsyncData > '(options).data.readerFn' response function must be called with parameters 'row' as array of data and 'total' as number of total records");return}f.data.total=i;f.data.rows=t;et();kt();lt()};s.raiseEvent(c.dataRequest);f.data.readerFn.call(this,r,u)}function kt(){ni();ri();ot();s.raiseEvent(c.rowsCreated)}function ut(t){if(n.isNoUoE(f.referenceField))return console.error("DatagridFactory > ExtractSelection > '(options).referenceField' must be set."),null;if(t===!0)return angular.copy(e);var i={selected:[],checked:[]};return n.each(e.selected,function(n){var r=f.data.rows[h.toIndex(n)];i.selected.push(t===!0?r[f.referenceField]:r)}),n.each(e.checked,function(n){var r=f.data.rows[h.toIndex(n)];i.checked.push(t===!0?r[f.referenceField]:r)}),i}function a(t){return $(n.printf("#{0}",t))}function dt(){$(p).empty();var i=t.div().id(o.container);f.layout.showHeader&&i.content(t.div().content(t.table().class(f.css.header).styles("margin: 0 !important;").content(t.thead().id(o.thead))));i.content(t.div().styleIf(n.isNotNoUoE(f.layout.height),"height",f.layout.height).styleIfElse(n.isNotNoU(f.layout.height),"overflow-y","scroll","hidden").styles("position: relative;").content(t.div().styles("position: relative;").content(t.table().class(f.css.body).classIf(f.selection.canSelect||f.selection.canCheck,f.css.bodySelectable).styles("margin: 0 !important;border: none !important;").content(t.tbody().id(o.tbody)))));f.layout.showFooter&&i.content(t.div().content(t.table().class(f.css.footer).styles("margin: 0 !important;").content(t.tfoot().id(o.tfooter))));$(p).html(i.build())}function gt(){var r,i;f.layout.showHeader&&(r=a(o.thead),r.empty(),i=t.tr(),f.selection.canCheck&&i.content(t.th().styles(l.checkCell).styles("border-bottom: none;").content(f.selection.canCheckMulti&&f.layout.showCheckAll?ht(!1):"")),n.each(f.columns,function(r,u){var e=[];r.sortable===!0&&e.push(t.a().attr("data-sort",u).style(r.halign==="right"?"left":"right","4px").styles("position: absolute; vertical-align: middle; cursor: pointer;").content(t.i().attr("data-sort-icon",u).class(f.icons.orderNone)));e.push(t.div().styles("overflow: hidden;").content(r.caption));i.content(t.th().attr("data-field",r.field).styleIf(n.isNotNoUoE(r.width),"width",r.width).styleIf(n.isNotNoUoE(r.halign),"text-align",r.halign).style("width",n.isNoUoE(r.width)?"auto":r.width).styles("position: relative; font-weight: bold; border-bottom: none;").content(e))}),n.isNotNoU(f.layout.height)&&i.content(t.th().styles("width: 16px !important; border-bottom: none;").content()),r.html(i.build()),r.find("tr a[data-sort]").click(ei))}function ni(){var t=a(o.tbody),n,i,r;if(t.find("tr").unbind(),t.empty(),h.indexes={},h.values={},f.data.rows.length!==0){for(n=0;n<f.data.rows.length;n++)h.indexes[n]=f.data.rows[n][f.referenceField],h.values[f.data.rows[n][f.referenceField]]=n,i=ft(f.data.rows[n],n,n===f.data.rows.length-1),t.append(i.build());f.selection.canSelect&&t.find("tr").click(yt);f.selection.canCheck&&(t.find("tr i[data-check]").click(pt),f.selection.canCheckMulti&&f.layout.showCheckAll&&(r=a(o.thead),r.find("tr i[data-check]").click(fi)))}}function ft(i,r,u){var h=t.tr().attr("row-id",r),s,e,o,c;for(f.selection.canCheck&&h.content(t.td().styleIf(r===0&&f.layout.showHeader,"border-top","none !important").styleIf(u&&f.layout.showFooter,"border-bottom","none !important").styles(l.checkCell).content(ht(!1))),s=0;s<f.columns.length;s++)e=f.columns[s],n.isFunction(e.formatter)?o=e.formatter(i[e.field],i,{rowIndex:r,colIndex:s,column:e}):(o=n.isNoU(i[e.field])?"":n.printf("{0}",i[e.field]),o=n.escape(o),o=n.replace(o,"\n","<br/>")),c=o,e.noCellContainer!==!0&&(c=t.div().style("overflow-x","hidden").style("text-overflow","ellipsis").styleIf(e.multiline===!1,"white-space","nowrap").styleIf(e.multiline===!1,"overflow-y","hidden").styleIf(e.multiline===!1,"height","20px").styleIf(n.isNotNoUoE(e.align),"text-align",e.align).content(o)),h.content(t.td().style("position","relative").styleIf(e.noCellContainer!==!0,"vertical-align","bottom !important;").styleIf(e.noCellContainer===!0,"padding","0 !important").styleIf(r===0&&f.layout.showHeader,"border-top","none !important").styleIf(u&&f.layout.showFooter,"border-bottom","none !important").style("width",n.isNoUoE(e.width)?"auto":e.width).content(c));return h}function ti(t){var i=h.toIndex(t);if(n.isNoU(i))return!1;var s=ft(f.data.rows[i],i,i===f.data.rows.length-1),u=n.printf("#{0} [row-id='{1}']",o.tbody,i),r=$(u);return r.find("i[data-check]").unbind(),r.unbind(),r.replaceWith(s.build()),r=$(u),f.selection.canSelect&&r.click(yt),f.selection.canCheck&&r.find("i[data-check]").click(pt),n.contains(e.selected,t)&&b(i,!0),n.contains(e.checked,t)&&g(i,!0),!0}function ii(){var u,i,r;f.layout.showFooter&&(u=a(o.tfooter),u.empty(),i=t.tr(),r=[],(f.layout.showClearCommand||f.layout.showRefreshCommand)&&((f.selection.canSelect||f.selection.canCheck)&&f.layout.showClearCommand&&r.push(t.a().styles(l.buttonActive).attr("data-command","erase").content(t.i().class(f.icons.erase)).styles("margin-right: 10px;")),f.layout.showRefreshCommand&&r.push(t.a().styles(l.buttonActive).attr("data-command","refresh").content(t.i().class(f.icons.refresh))),r.length>0&&i.content(t.th().styles("width: 15%; text-align: left; border: none; vertical-align: middle; padding: 3px 0 0 10px;").content(r))),(f.selection.canSelect||f.selection.canCheck)&&f.layout.showSelections&&i.content(t.th().id(o.selection).styles("width: 15%; text-align: left; border: none; vertical-align: middle; padding: 3px 0 0 10px;").content(r)),i.content(t.th().id(o.pager).styles("height: 37px; position: relative;").styles("text-align: center; border: none; vertical-align: middle; padding: 3px 0 0 0")),f.layout.showTotals&&i.content(t.th().id(o.records).styles("width: 30%; text-align: right; border: none; vertical-align: middle; padding: 3px 10px 0 0").content()),u.html(i.build()),(f.selection.canSelect||f.selection.canCheck)&&f.layout.showClearCommand&&($(n.printf("#{0} th a[data-command='erase']",o.tfooter)).tooltip({title:f.labels.tooltipErase,container:"body",placement:"top",trigger:"hover"}),$(n.printf("#{0} th a[data-command='erase']",o.tfooter)).click(si)),f.layout.showRefreshCommand&&($(n.printf("#{0} th a[data-command='refresh']",o.tfooter)).tooltip({title:f.labels.tooltipRefresh,container:"body",placement:"top",trigger:"hover"}),$(n.printf("#{0} th a[data-command='refresh']",o.tfooter)).click(hi)),ot())}function ri(){for(var i,u,r,t=0;t<f.columns.length;t++)i=f.columns[t],n.isNotNoUoE(i.tooltip)&&(u=n.printf("#{0} th[data-field='{1}']",o.thead,i.field),r=$(u),r.length>0&&r.tooltip({title:i.tooltip,container:"body",html:!0,placement:"top",trigger:"hover"}))}function et(){var u=a(o.records),i,r,e,s;u.length!==0&&(i="",n.isNoUoZ(f.data.total)?i=f.labels.noRecords:f.data.paged?(r=(f.data.page-1)*f.data.size,e=r+f.data.size,i=n.printf(f.labels.totalRecordsPaged,r,e,f.data.total)):i=n.printf(f.labels.totalRecords,f.data.total),s=t.label().styles("font-weight: normal; margin: 0;").content(i),u.html(s.build()))}function ot(){var u,i,r,h;if(f.layout.showFooter&&f.data.paged&&(u=a(o.pager),u.length!==0)){u.find("a").unbind();u.empty();i=f.data.page;r=parseInt(f.data.total/f.data.size);f.data.total/f.data.size>parseInt(f.data.total/f.data.size)&&r++;var c=i>1?l.buttonActive:l.buttonDisabled,y=i>1?l.buttonActive:l.buttonDisabled,p=i<r?l.buttonActive:l.buttonDisabled,w=i<r?l.buttonActive:l.buttonDisabled,e=t.div(),s=t.span().content("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;");r>0&&(s=t.a().id(o.pageLabel).content(t.label().styles("padding: 0; margin: 0; min-width: 80px; font-weight: normal; cursor: pointer; vertical-align: text-bottom;").content(n.printf(f.labels.pageOfPages,i,r))),e=t.div().id(o.popupGoTo).style("display","none").styles("position: absolute; z-index: 2000; top: -64px; left: 50%; width: 300px; margin-left: -150px; height: 64px; border: solid 1px #999999; background-color: #eeeeee; padding: 5px; text-align: left;").content(t.div().content(t.label().content(f.labels.goToPage),t.input().type("text").styles("width: 100%; font-size: 14px; height: 26px;"))));h=t.div().styles("padding: 0; margin: 0;").content(e,t.a().attrIf(i>1,"action","PP").styles(c).content(t.i().class(f.icons.pagerFirst)),t.a().attrIf(i>1,"action","P").styles(y).content(t.i().class(f.icons.pagerPrev)),s,t.a().attrIf(i<r,"action","N").styles(p).content(t.i().class(f.icons.pagerNext)),t.a().attrIf(i<r,"action","NN").styles(w).content(t.i().class(f.icons.pagerLast)));u.html(h.build());u.find("#"+o.pageLabel).click(function(){var i=a(o.popupGoTo),t=i.find("input");i.fadeIn(100);t.focus();t.focusout(function(){i.fadeOut(100);t.val("");t.unbind()});t.keypress(function(u){var o,e;u.keyCode===13&&(i.fadeOut(100),o=t.val(),t.val(""),e=n.castAsNumeric(o),n.isNoUoZ(e)===!1&&(e<1&&(e=1),e>r&&(e=r),t.unbind(),f.data.page=e,v()))})});u.find("[action]").click(oi)}}function st(){var i=n.printf("#{0} th i[data-sort-icon]",o.thead),t;$(i).removeClass(f.icons.orderAsc).removeClass(f.icons.orderDesc).addClass(f.icons.orderNone);n.isNotNoU(f.data.sort.index)&&(t=n.printf("#{0} th i[data-sort-icon='{1}']",o.thead,f.data.sort.index),$(t).addClass(f.data.sort.direction==="asc"?f.icons.orderAsc:f.icons.orderDesc))}function w(){var r=a(o.selection),u,i,s;r.length!==0&&(u=f.selection.canSelect===!0&&f.selection.canCheck===!0&&f.selection.canSelectMulti&&f.selection.canCheckMulti&&f.selection.selectionsLinked,i="",u?i+=n.printf("{0}",e.checked.length):(f.selection.canCheck&&(i+=n.printf("{0}",e.checked.length)),f.selection.canCheck&&f.selection.canSelect&&(i+="/"),f.selection.canSelect&&(i+=n.printf("{0}",e.selected.length))),s=t.div().styles("white-space: nowrap;").content(t.i().class(f.icons.cmdConfirm).styles("margin-right: 5px"),t.label().styles("font-weight: normal;").content(i)),r.html(s.build()))}function ht(n){if(!f.selection.canCheck)return t.span().content("?");var i=n===!0?f.icons.checkTrue:f.icons.checkFalse;return t.i().attr("data-check",n?"true":"false").styles("padding: 10px 5px !important; cursor: pointer;").class(i)}function ui(){var i=a(o.thead),n,t;i.find("tr i[data-check]").unbind();i.find("tr a[data-sort]").unbind();n=a(o.tbody);n.find("tr").unbind();n.find("tr i[data-check]").unbind();t=a(o.pager);t.find("[action]").unbind();t.find("#"+o.pageLabel).unbind();$(p).empty();rt()}function ct(t,i){var r=f.data.rows[t][f.referenceField],u,o;f.selection.canSelect&&i==="row"&&(u=n.contains(e.selected,r),tt(r,!u),f.selection.selectionsLinked&&f.selection.canCheck&&it(r,!u));f.selection.canCheck&&i==="check"&&(o=n.contains(e.checked,r),it(r,!o),vt(),f.selection.selectionsLinked&&f.selection.canSelect&&tt(r,!o));w();s.raiseEvent(c.rowClicked,f.data.rows[t],t)}function lt(t,i){n.isArray(t)&&f.selection.canSelect&&(e.selected=angular.copy(t));n.isArray(i)&&f.selection.canCheck&&(e.checked=angular.copy(i));e.selected.length>1&&f.selection.canSelectMulti===!1&&(e.selected=[e.selected[0]]);e.checked.length>1&&f.selection.canCheckMulti===!1&&(e.checked=[e.checked[0]]);d();n.each(e.selected,function(n){b(h.toIndex(n),!0)});nt();n.each(e.checked,function(n){g(h.toIndex(n),!0)});w()}function y(){d();nt();e.selected=[];e.checked=[];w();s.raiseEvent(c.clearSelection)}function tt(t,i){var r=h.toIndex(t),u;if(n.isNoU(r))return!1;if(n.isNotNoU(i))if(i===!0){if(n.contains(e.selected,t)===!0)return!1;f.selection.canSelectMulti===!1&&(u=e.selected.length>0?h.toIndex(e.selected[0]):null,d(),e.selected=[],n.isNotNoU(u)&&s.raiseEvent(c.rowUnselected,f.data.rows[u],u));b(r,!0);e.selected.push(t);s.raiseEvent(c.rowSelected,f.data.rows[r],r)}else{if(n.contains(e.selected,t)===!1)return!1;b(r,!1);e.selected=n.without(e.selected,t);s.raiseEvent(c.rowUnselected,f.data.rows[r],r)}return!0}function it(t,i){var r=h.toIndex(t),u;if(n.isNoU(r))return!1;if(n.isNotNoU(i))if(i===!0){if(n.contains(e.checked,t)===!0)return!1;f.selection.canCheckMulti===!1&&(u=e.checked.length>0?h.toIndex(e.checked[0]):null,nt(),e.checked=[],n.isNotNoU(u)&&s.raiseEvent(c.rowUnchecked,f.data.rows[u],u));g(r,!0);e.checked.push(t);s.raiseEvent(c.rowChecked,f.data.rows[r],r)}else{if(n.contains(e.checked,t)===!1)return!1;g(r,!1);e.checked=n.without(e.checked,t);s.raiseEvent(c.rowUnchecked,f.data.rows[r],r)}return!0}function b(t,i){var r=n.printf("#{0} tr[row-id='{1}']",o.tbody,t);i===!0?$(r).addClass(f.css.selection):$(r).removeClass(f.css.selection)}function d(){var t=n.printf("#{0} tr",o.tbody);$(t).removeClass(f.css.selection)}function g(t,i){var r=n.printf("#{0} tr[row-id='{1}'] i[data-check]",o.tbody,t);i===!0?$(r).removeClass(f.icons.checkFalse).addClass(f.icons.checkTrue):$(r).removeClass(f.icons.checkTrue).addClass(f.icons.checkFalse);$(r).attr("data-check",i)}function nt(){var t=n.printf("#{0} tr i[data-check]",o.tbody);$(t).removeClass(f.icons.checkTrue).addClass(f.icons.checkFalse);$(t).attr("data-check",!1)}function at(t){if(f.layout.showHeader){var i=n.printf("#{0} tr i[data-check]",o.thead);t===!0?$(i).removeClass(f.icons.checkFalse).addClass(f.icons.checkTrue):$(i).removeClass(f.icons.checkTrue).addClass(f.icons.checkFalse);$(i).attr("data-check",t)}}function vt(){if(f.layout.showHeader){var r=n.printf("#{0} tr i[data-check='true']",o.tbody),u=n.printf("#{0} tr i[data-check]",o.tbody),t=$(r).length,i=$(u).length;return at(t===i),t===i}}function yt(n){n.stopPropagation();var t=$(n.currentTarget).attr("row-id");ct(parseInt(t),"row")}function pt(n){n.stopPropagation();var t=$(n.currentTarget).closest("tr").attr("row-id");ct(parseInt(t),"check")}function fi(t){var r,a,u,l,v,i;if(t.stopPropagation(),a=vt(),u=f.selection.selectionsLinked&&f.selection.canSelect&&f.selection.canSelectMulti,a)nt(),e.checked=[],u&&(d(),e.selected=[]),r=!1;else{for(l=n.printf("#{0} tr i[data-check]",o.tbody),$(l).removeClass(f.icons.checkFalse).addClass(f.icons.checkTrue),$(l).attr("data-check",!0),v=$(l).length,u&&(e.selected=[]),e.checked=[],i=0;i<v;i++)u&&(e.selected.push(h.toRef(i)),b(i,!0)),e.checked.push(h.toRef(i));r=!0}at(r);w();s.raiseEvent(c.checkAll,r)}function ei(n){n.stopPropagation();var t=parseInt($(n.currentTarget).attr("data-sort"));f.data.sort.field=f.columns[t].field;f.data.sort.index=t;f.data.sort.direction=f.data.sort.direction==="asc"?"desc":"asc";st();f.selection.clearOnSorting&&y();v();s.raiseEvent(c.columnSort,f.columns[t],f.data.sort.direction)}function oi(n){n.stopPropagation();var i=f.data.page,r=$(n.currentTarget).attr("action"),t=parseInt(f.data.total/f.data.size);f.data.total/f.data.size>parseInt(f.data.total/f.data.size)&&t++;switch(r){case"PP":f.data.page=1;break;case"P":f.data.page--;break;case"N":f.data.page++;break;case"NN":f.data.page=t}f.selection.clearOnPaging&&y();v();s.raiseEvent(c.pageChanged,f.data.page,i)}function si(n){n.stopPropagation();y()}function hi(n){n.stopPropagation();f.data.sort.field=null;f.data.sort.index=null;f.data.sort.direction=null;y();st();v();s.raiseEvent(c.reloadData)}var s=i.create(),k,p,f,e,h,c={created:"table-created",dataRequest:"data-request",rowsCreated:"rows-created",rowClicked:"row-clicked",rowChecked:"row-checked",rowUnchecked:"row-unchecked",rowSelected:"row-selected",rowUnselected:"row-unselected",clearSelection:"clear-selection",reloadData:"data-reload",pageChanged:"page-changed",columnSort:"column-sort",checkAll:"check-all"},o={container:n.uniqueId("datatable-container-"),thead:n.uniqueId("datatable-thead-"),tbody:n.uniqueId("datatable-tbody-"),tfooter:n.uniqueId("datatable-tfooter-"),pager:n.uniqueId("datatable-pager-"),selection:n.uniqueId("datatable-selection-"),pageLabel:n.uniqueId("datatable-page-label-"),popupGoTo:n.uniqueId("popup-go-to-"),records:n.uniqueId("datatable-records-")},l={checkCell:"width: 32px; text-align: center; font-size: 14px; font-weight: lighter; padding: 0 !important",buttonActive:"padding: 0; margin: 0 3px; font-size: 18px; cursor: pointer;",buttonDisabled:"padding: 0; margin: 0 3px; font-size: 18px; color: #bbbbbb;"};return rt(),k={identities:angular.copy(o),clearSelection:y,setSelection:lt,destroyTable:ui,eventRegister:s.registerEvent,eventRemoveById:s.removeByEventId,refreshRowByRef:ti,setRowSelection:function(t,i,r){var u=n.isNoU(i)?!0:tt(t,i),f=n.isNoU(r)?!0:it(t,r);return u||f},refreshData:function(n){n===!0&&y();v()},getSelection:function(){return ut(!0)},getSelectionRecords:function(){return ut(!1)}},bt(r,u),k}return console.info("ngTableFactory factory"),{create:function(n,t){return new r(n,t)}}}]).factory("TableFactoryEvents",["TableFactoryUtility",function(n){function t(){function r(r,u){if(n.isNoUoE(r))return console.error("DatagridEventFactory > Register > parameter 'name' must be a valid (non empty) property name"),null;if(n.isFunction(u)===!1)return console.error("DatagridEventFactory > Register > parameter 'callFn' must be a valid function"),null;var f=++i;return t.push({id:f,name:r,callFn:u}),f}function u(){t=[]}function f(i){n.each(t,function(n){n.id===i&&(n.delete=!0)});t=n.map(t,function(n){return n.delete===!0?null:n})}function e(i,r,u){n.each(t,function(n){n.name===i&&n.callFn.call(this,r,u)})}var i=0,t=[];return{registerEvent:r,clearEvents:u,removeByEventId:f,raiseEvent:e}}return{create:function(){return new t}}}]).factory("TableFactoryHtml",["TableFactoryUtility",function(n){function r(t,i){this.name=t;this.selfClose=i;this.attrs={};this.children=[];this.css=[];this.classes=[];this.attr=function(t,i){return n.isNotNoUoE(i)&&(this.attrs[t]=i),this};this.attrIf=function(n,t,i){return n!==!0?this:this.attr(t,i)};this.role=function(n){return this.attr("data-role",n)};this.styleIf=function(n,t,i){return n!==!0?this:this.style(t,i)};this.styleIfElse=function(n,t,i,r){return n!==!0?this.style(t,r):this.style(t,i)};this.style=function(t,i){return n.isNoUoE(i)?this:(this.css.push({name:t,value:i}),this)};this.styles=function(t){if(n.isNoUoE(t))return this;var i=this,r=t.split(";");return n.each(r,function(t){var u=t.split(":"),r,f;u.length>0&&(r=u.length>0?u[0]:"",n.isNotNoUoE(r)&&(f=u.length>1?u[1]:"",r=n.isNoUoE(r)?"":r.trim(),f=n.isNoUoE(f)?"":f.trim(),i.css.push({name:r,value:f})))}),this};this.classIf=function(n,t,i){return this.class(n?t:i)};this.class=function(){for(var t=0;t<arguments.length;t++)n.isNoUoE(arguments[t])||this.classes.push(arguments[t].toString());return this};this.content=function(){for(var t,r,i=0;i<arguments.length;i++)if(t=arguments[i],!n.isNoU(t))if(n.isArray(t))for(r=0;r<t.length;r++)this.children.push(t[r]);else this.children.push(t);return this};this.build=function(t){var f,o,e,i,u,s;n.isString(t)===!1&&(t="");t+="<"+this.name;this.css.length>0&&(f="",n.each(this.css,function(n){f+=n.name+": "+n.value+"; "}),t+=' style="'+f+'"');this.classes.length>0&&(o=this.classes.join(" "),t+=' class="'+o+'"');n.each(this.attrs,function(i){n.isNotNoU(i.value)&&(t+=" "+i.key+'="'+i.value+'"')});for(e in this.attrs)t+=" "+e+'="'+this.attrs[e]+'"';if(this.selfClose)t+="/>";else{for(t+=">",i=0;i<this.children.length;i++)u=this.children[i],u instanceof r?(s=u.build(),t+=s):t+=u.toString();t+="<\/"+this.name+">"}return t}}function h(t){return function(){var i=new r(t,n.contains(s,t));return i.content.apply(i,arguments)}}for(var f,e,t,o=["id","title","type","name","href","src","alt","height","width","unselectable","for","value","checked","disabled","readonly","rowspan","colspan","onclick","value"],i=["div","h1","h2","h3","h4","h5","h6","ul","li","hr","a","span","br","i","b","select","option","small","img","label","input","textarea","button","table","thead","tfoot","tbody","tr","th","td"],s=["hr","br","img","input"],u=0;u<o.length;u++)f=o[u],r.prototype[f]=function(n){return function(t){return this.attr(n,t)}}(f);for(e={},t=0;t<i.length;t++)e[i[t]]=h(i[t]);return e}]).factory("TableFactoryUtility",function(){var n=this,t=0;return this.is=function(t,i){return Object.prototype.toString.call(t)===n.printf("[object {0}]",i)},this.isArray=Array.isArray||function(t){return n.is(t,"Array")},this.isString=function(t){return n.is(t,"String")},this.isFunction=function(t){return n.is(t,"Function")},this.isNoU=function(n){return n===void 0?!0:n===null?!0:!1},this.isNoUoZ=function(n){return n===void 0?!0:n===null?!0:isNaN(n)?!0:n===0?!0:!1},this.isNoUoE=function(t){return t===void 0?!0:t===null?!0:n.is(t,"String")?t==="":!1},this.isNotNoU=function(t){return!n.isNoU(t)},this.isNotNoUoE=function(t){return!n.isNoUoE(t)},this.isArrayNullOrEmpty=function(t){return t===void 0?!0:t===null?!0:n.is(t,"Array")===!1?!0:t.length===0},this.isArrayNotEmpty=function(t){return t===void 0?!1:t===null?!1:n.is(t,"Array")===!1?!1:t.length>0},this.replace=function(t,i,r){return n.isNoUoE(t)?t:t.split(i.toString()).join(r.toString())},this.castAsNumeric=function(t){var i,u,r;if(n.isNoU(t)||(i=t.toString(),i=$.trim(i),i.length===0))return null;for(u=["0","1","2","3","4","5","6","7","8","9","+","-"],r=0;r<i.length;r++)if(u.indexOf(i[r])===-1)return null;return parseInt(t)},this.each=function(t,i){if(n.is(t,"Array")!==!1&&n.is(i,"Function")!==!1)for(var r=0;r<t.length;r++)i.call(this,t[r],r)},this.find=function(t,i){var r,u;if(n.is(t,"Array")===!1||n.is(i,"Function")===!1)return null;for(r=0;r<t.length;r++)if(u=i.call(this,t[r],r),u===!0)return t[r];return null},this.extract=function(t,i){var u,r;if(n.is(t,"Array")===!1)return[];if(n.isNoUoE(i))return[];for(u=[],r=0;r<t.length;r++)u.push(t[r][i]);return u},this.contains=function(t,i){if(n.is(t,"Array")===!1||n.isNoU(i))return!1;for(var r=0;r<t.length;r++)if(t[r]===i)return!0;return!1},this.without=function(t,i){var u,r;if(n.is(t,"Array")===!1||n.isNoU(i))return!1;for(u=[],r=0;r<t.length;r++)t[r]!==i&&u.push(t[r]);return u},this.map=function(t,i){if(n.isArrayNullOrEmpty(t))return null;var r=[];return n.each(t,function(t){var u=i.call(this,t);n.isNotNoU(u)&&r.push(u)}),r},this.defaults=function(t,i){n.isNoU(t)&&(t={});n.isNoU(i)&&(i={});for(var r in i)i.hasOwnProperty(r)&&t[r]===void 0&&(t[r]=i[r]);return t},this.printf=function(){var i,t,r,u;if(arguments.length===0)return null;if(arguments.length===1)return arguments[1];for(i=arguments[0],t=1;t<arguments.length;t++)r=arguments[t],u="{"+(t-1)+"}",n.isNoU(r)&&(r=""),i=i.split(u).join(r.toString());return i},this.uniqueId=function(i){return n.printf("{0}{1}",i,t++)},this.escape=function(t){var i=t;return n.each([{pre:"&",post:"&amp;"},{pre:"<",post:"&lt;"},{pre:">",post:"&gt;"},{pre:'"',post:"&quot;"},{pre:"'",post:"&#x27;"},{pre:"`",post:"&#x60;"}],function(n){i.split(n.pre).join(n.post)}),i},this.isValidCssSize=function(t){var i,r;return n.isNoUoE(t)?!1:(i=t.trim().toLocaleLowerCase(),i==="auto")?!0:i==="inherit"?!0:(r=function(t){var r=i.split(t);return r.length!==2?!1:r[1]!==""?!1:n.castAsNumeric(r[0])!==null},r("px"))?!0:r("%")?!0:!1},this.titleFromCamelCase=function(t){var u,r,i;if(n.isNoUoE(t))return"";if(t.length===1)return t.toUpperCase();for(u="ABCDEFGHIJKLMNOPQRSTUVWXYZ",r=t[0].toUpperCase(),i=1;i<t.length;i++)r+=u.indexOf(t[i])===-1?t[i]:n.printf(" {0}",t[i].toUpperCase());return r},this.safeApply=function(n,t){if(n!==null&&n!==undefined){var i=n.$root!=null?n.$root.$$phase:n.$$phase;i==="$apply"||i==="$digest"?t&&typeof t=="function"&&t():n.$apply()}},this})